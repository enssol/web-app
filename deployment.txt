make clean && make test

# Development build
make ENV=dev

# Production build with optimizations
make ENV=prod

# Create package
make package


# Access container volume
cd /home/ubuntu/.local/share/containers/storage/volumes/pod_vol/_data/web-app

# Build production package
make clean
make ENV=prod

# Create deployment package
tar -cJf ~/webserver.tar.xz bin/webserver www/

# Verify package
ls -l ~/webserver.tar.xz
chmod 644 ~/webserver.tar.xz

# Create service user
sudo useradd -r -s /sbin/nologin webserver

# Create application directory
sudo mkdir -p /opt/webserver

# 1. Extract package to correct path
sudo tar xf ~/webserver.tar.xz -C /opt/webserver

# 2. Set ownership
sudo chown -R webserver:webserver /opt/webserver

# 3. Set capabilities for port binding
sudo setcap cap_net_bind_service=+ep /opt/webserver/bin/webserver

# 4. Verify installation
ls -l /opt/webserver/bin/webserver
ls -l /opt/webserver/www/

# Set ownership and permissions
sudo chown -R webserver:webserver /opt/webserver

# Set capabilities for port binding
sudo setcap cap_net_bind_service=+ep /opt/webserver/bin/webserver

# Setup UFW
sudo ufw enable
sudo ufw allow 8080/tcp
sudo ufw status numbered

# Create service file
sudo tee /etc/systemd/system/webserver.service << 'EOF'
[Unit]
Description=EnvEng Web Server
After=network.target

[Service]
Type=simple
User=root
Group=root
ExecStart=/opt/webserver/bin/webserver
Restart=on-failure
AmbientCapabilities=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target
EOF

# Enable and start service
sudo systemctl daemon-reload
sudo systemctl enable webserver
sudo systemctl start webserver

# Check service status
sudo systemctl status webserver


DNS Configuration
Update DNS A record:
Type: A
Name: @
Value: 203.51.2.82
TTL: 3600

# Development mode
make ENV=dev
./bin/webserver

# Test local access
curl http://localhost:49152

# Test production host
curl -H "Host: enssol.com.au" http://localhost:49152

# Test www subdomain
curl -H "Host: www.enssol.com.au" http://localhost:49152

# Production mode (as root)
sudo make ENV=prod
sudo ./bin/webserver

# Test external access
curl http://localhost
curl http://203.51.2.82
curl http://enssol.com.au
curl http://www.enssol.com.au
